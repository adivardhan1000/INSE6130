import subprocess

cmd = 'docker --version'
output = subprocess.check_output(cmd, shell=True).decode()
#print(output)
docker_version = output.strip().split()[2].split(',')[0]

if docker_version < '18.09.4':
	print("Vulnerable")
	if input("Would you like to proceed with the fix?(YES/NO)").upper() == 'YES':
		get_versions = "sudo apt-get update && apt-cache madison docker-ce | awk '{ print $3 }'"
		output = subprocess.check_output(get_versions, shell=True).decode()
		for line in output.split("\n"):
			if '18.09.4' in line:
				version = line
				break
		print(version)
		bump = "VERSION_STRING=" + version + " && sudo apt-get install docker-ce=$VERSION_STRING docker-ce-cli=$VERSION_STRING containerd.io docker-buildx-plugin docker-compose-plugin"
		output = subprocess.check_output(bump, shell=True).decode()
		output = subprocess.check_output(cmd, shell=True).decode()
		print("Docker version upgraded to "+output)
else:
	print("safe")
